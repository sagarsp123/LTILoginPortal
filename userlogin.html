<!DOCTYPE html>
<html>

<head>
  <link rel="stylesheet" href="css/style.css">
  <script src="js/scriptfile.js"></script>
  <script>
    window.onload = () => {
      console.log("cc" + document.cookie.length);
      if (document.cookie.indexOf('lti=') != -1) {
        console.log("cook" + document.cookie);
        cookiearray = document.cookie.split(';');
        console.log(cookiearray);
        var ind = document.cookie.indexOf('lti=');
        var ind1 = document.cookie.indexOf('ltipass=');
        var nam = cookiearray[0].split("=")[0];
        var nam1 = cookiearray[0].split("=")[1];
        var nam2 = cookiearray[1].split("=")[1];
        // var nam2 = cookiearray[ind].split("=")[2];
        // var nam3 = cookiearray[ind].split("=")[3];

        var name = CryptoJS.AES.decrypt(nam1, "ltichampions").toString(CryptoJS.enc.Utf8);
        var pass = CryptoJS.AES.decrypt(nam2, "ltichampions").toString(CryptoJS.enc.Utf8);
        console.log(`${cookiearray} and ${ind} and ${name} and ${pass} `);
        if (name == "LTI" && pass == "123") {
          window.location = "welcome.html";
        }
        else {
          window.location = "userlogin.html"
        }
      }
    }

    function backend() {
      let inputUser = document.getElementById('inputUser').value;
      let inputPassword = document.getElementById('inputPassword').value;
      let pp = document.getElementById('newname');

      if (inputUser == "LTI" && inputPassword == "123") {
        localStorage.setItem("inputUser", inputUser);
        if (document.getElementById('check').checked) {
          //             var date = new Date();
          //     // date.setTime(date.getTime()+days*24*60*60*1000); // ) removed
          //     var expires = "; expires=" + date.toGMTString(); // + added
          //   document.cookie = name+"=" + name+expires + ";path=/";
          //   console.log(document.cookie);
          var date = new Date();
          date.setTime(date.getTime() + 1 * 24 * 60 * 60 * 1000);
          var expires = "expires=" + date.toUTCString();
          var encname = CryptoJS.AES.encrypt(name, "ltichampions");
          var encpass = CryptoJS.AES.encrypt(pass, "ltichampions");
          console.log(`${encname} and ${encpass}`);
          console.log(expires);
          document.cookie = 'lti=' + encname; expires; 'path=/';
          document.cookie = 'ltipass=' + encpass; expires; 'path=/';
          console.log(document.cookie);
        }
        window.open('welcome.html');


      }
      else {
        document.getElementById('message').innerHTML = "Invalid username/password combination!!";
      }

    }
  </script>

</head>

<div class="login">
  <h1>Login to Web App</h1>
  <form method="post" action="">
    <p><input type="text" id="inputUser" class="form-control" value="" placeholder="Username" required autofocus></p>
    <p><input type="password" id="inputPassword" class="form-control" value="" placeholder="Password" required></p>
    <div id="remember" class="checkbox">
      <label>
        <input id = "check" type="checkbox" value="remember-me"> Remember me
      </label>
    </div>
    <p class="submit"><input type="submit" name="commit" value="Submit" onclick="backend();"></p>
  </form>
</div>

<div class="login-help">
  <p>Forgot your password? <a href="#">Click here to reset it</a>.</p>
</div>

</html>